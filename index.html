<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>21 é»ï¼ˆBlackjackï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", "Noto Sans TC", sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .message-area {
            background: #f0f4f8;
            border-left: 4px solid #2a5298;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            min-height: 60px;
            font-size: 1.1em;
            color: #1e3c72;
        }

        .game-area {
            margin: 20px 0;
        }

        .hand-section {
            background: #fafafa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .hand-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #1e3c72;
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            min-height: 80px;
        }

        .card {
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 15px 12px;
            font-size: 1.5em;
            min-width: 60px;
            text-align: center;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.red {
            color: #d32f2f;
        }

        .card.black {
            color: #333;
        }

        .card.hidden {
            background: linear-gradient(45deg, #1e3c72 25%, #2a5298 25%, #2a5298 50%, #1e3c72 50%, #1e3c72 75%, #2a5298 75%);
            background-size: 20px 20px;
            color: white;
            border-color: #1e3c72;
        }

        .hand-total {
            font-size: 1.2em;
            font-weight: bold;
            color: #2a5298;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        button {
            background: #2a5298;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover:not(:disabled) {
            background: #1e3c72;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        button:focus {
            outline: 3px solid #ffd700;
            outline-offset: 2px;
        }

        .result-win {
            background: #4caf50 !important;
            border-color: #2e7d32 !important;
        }

        .result-lose {
            background: #f44336 !important;
            border-color: #c62828 !important;
        }

        .result-push {
            background: #ff9800 !important;
            border-color: #ef6c00 !important;
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .card {
                font-size: 1.2em;
                min-width: 50px;
                padding: 10px 8px;
            }

            button {
                padding: 12px 20px;
                font-size: 1em;
            }

            .controls {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>21 é»ï¼ˆBlackjackï¼‰</h1>
        
        <div class="message-area" role="status" aria-live="polite" id="message">
            æ­¡è¿ä¾†åˆ° 21 é»éŠæˆ²ï¼æŒ‰ä¸‹ã€Œé–‹å§‹ç™¼ç‰Œã€é–‹å§‹éŠæˆ²ã€‚
        </div>

        <div class="game-area">
            <!-- èŠå®¶å€ -->
            <div class="hand-section">
                <div class="hand-title">èŠå®¶ï¼ˆDealerï¼‰</div>
                <div class="cards" id="dealer-cards"></div>
                <div class="hand-total" id="dealer-total">é»æ•¸ï¼š?</div>
            </div>

            <!-- ç©å®¶å€ -->
            <div class="hand-section">
                <div class="hand-title">ç©å®¶ï¼ˆPlayerï¼‰</div>
                <div class="cards" id="player-cards"></div>
                <div class="hand-total" id="player-total">é»æ•¸ï¼š0</div>
            </div>
        </div>

        <!-- æ§åˆ¶æŒ‰éˆ• -->
        <div class="controls">
            <button id="start-btn">é–‹å§‹ç™¼ç‰Œ</button>
            <button id="hit-btn" disabled>è¦ç‰Œ (Hit)</button>
            <button id="stand-btn" disabled>åœç‰Œ (Stand)</button>
            <button id="reset-btn" disabled>å†ç©ä¸€å±€</button>
        </div>
    </div>

    <script>
        // ===== è³‡æ–™æ¨¡å‹ =====
        const suits = {
            spades: 'â™ ',
            hearts: 'â™¥',
            diamonds: 'â™¦',
            clubs: 'â™£'
        };

        const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            phase: 'idle', // idle, player, dealer, result
            deck: [],
            playerHand: [],
            dealerHand: [],
            result: null
        };

        // ===== Deck èˆ‡æŠ½ç‰Œå‡½å¼ =====
        function createDeck() {
            const deck = [];
            for (let suit in suits) {
                for (let rank of ranks) {
                    deck.push({
                        suit: suit,
                        rank: rank,
                        display: suits[suit] + rank
                    });
                }
            }
            return deck;
        }

        // Fisher-Yates æ´—ç‰Œæ¼”ç®—æ³•
        function shuffle(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }

        function drawCard(deck) {
            if (deck.length === 0) {
                setMessage('ç‰Œå †å·²ç©ºï¼Œé‡æ–°å»ºç«‹ç‰Œå †ã€‚');
                deck.push(...createDeck());
                shuffle(deck);
            }
            return deck.pop();
        }

        // ===== é»æ•¸è¨ˆç®— =====
        function getCardValue(rank) {
            if (rank === 'A') return 11;
            if (['J', 'Q', 'K'].includes(rank)) return 10;
            return parseInt(rank);
        }

        function calculateHandTotal(hand) {
            let total = 0;
            let aces = 0;

            // å…ˆè¨ˆç®—ç¸½é»æ•¸ï¼ŒA éƒ½ç•¶ 11
            for (let card of hand) {
                total += getCardValue(card.rank);
                if (card.rank === 'A') aces++;
            }

            // è‹¥çˆ†ç‰Œä¸”æœ‰ Aï¼Œå°‡ A å¾ 11 é™ç‚º 1
            while (total > 21 && aces > 0) {
                total -= 10;
                aces--;
            }

            return total;
        }

        // ===== UI èˆ‡æ—ç™½ =====
        function setMessage(text) {
            document.getElementById('message').textContent = text;
        }

        function renderHand(hand, elementId, hideFirst = false) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';

            hand.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                
                if (hideFirst && index === 0) {
                    cardDiv.textContent = 'ğŸ‚ ';
                    cardDiv.className = 'card hidden';
                } else {
                    cardDiv.textContent = card.display;
                    if (card.suit === 'hearts' || card.suit === 'diamonds') {
                        cardDiv.classList.add('red');
                    } else {
                        cardDiv.classList.add('black');
                    }
                }
                
                container.appendChild(cardDiv);
            });
        }

        function render() {
            const { phase, playerHand, dealerHand } = gameState;

            // é¡¯ç¤ºç©å®¶æ‰‹ç‰Œ
            renderHand(playerHand, 'player-cards');
            const playerTotal = calculateHandTotal(playerHand);
            document.getElementById('player-total').textContent = `é»æ•¸ï¼š${playerTotal}`;

            // é¡¯ç¤ºèŠå®¶æ‰‹ç‰Œï¼ˆç©å®¶å›åˆæ™‚éš±è—ç¬¬ä¸€å¼µï¼‰
            const hideDealer = (phase === 'player' || phase === 'idle');
            renderHand(dealerHand, 'dealer-cards', hideDealer);
            
            if (hideDealer && dealerHand.length > 0) {
                // åªé¡¯ç¤ºæ˜ç‰Œçš„é»æ•¸
                const visibleTotal = dealerHand.slice(1).reduce((sum, card) => 
                    sum + getCardValue(card.rank), 0);
                document.getElementById('dealer-total').textContent = `é»æ•¸ï¼š? (æ˜ç‰Œ ${visibleTotal})`;
            } else if (dealerHand.length > 0) {
                const dealerTotal = calculateHandTotal(dealerHand);
                document.getElementById('dealer-total').textContent = `é»æ•¸ï¼š${dealerTotal}`;
            } else {
                document.getElementById('dealer-total').textContent = 'é»æ•¸ï¼š?';
            }

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            const startBtn = document.getElementById('start-btn');
            const hitBtn = document.getElementById('hit-btn');
            const standBtn = document.getElementById('stand-btn');
            const resetBtn = document.getElementById('reset-btn');

            startBtn.disabled = (phase !== 'idle');
            hitBtn.disabled = (phase !== 'player');
            standBtn.disabled = (phase !== 'player');
            resetBtn.disabled = (phase !== 'result');

            // çµæœæ™‚æ”¹è®Šè¨Šæ¯å€æ¨£å¼
            const messageArea = document.getElementById('message');
            messageArea.className = 'message-area';
            if (phase === 'result') {
                if (gameState.result === 'player_win') {
                    messageArea.classList.add('result-win');
                } else if (gameState.result === 'dealer_win') {
                    messageArea.classList.add('result-lose');
                } else if (gameState.result === 'push') {
                    messageArea.classList.add('result-push');
                }
            }
        }

        // ===== éŠæˆ²æµç¨‹ =====
        function startRound() {
            // é‡ç½®ç‹€æ…‹
            gameState.deck = createDeck();
            shuffle(gameState.deck);
            gameState.playerHand = [];
            gameState.dealerHand = [];
            gameState.result = null;
            gameState.phase = 'player';

            // ç™¼ç‰Œï¼šç©å®¶ 2 å¼µï¼ŒèŠå®¶ 2 å¼µ
            gameState.playerHand.push(drawCard(gameState.deck));
            gameState.dealerHand.push(drawCard(gameState.deck));
            gameState.playerHand.push(drawCard(gameState.deck));
            gameState.dealerHand.push(drawCard(gameState.deck));

            // æª¢æŸ¥æ˜¯å¦æœ‰ Blackjack
            const playerTotal = calculateHandTotal(gameState.playerHand);
            const dealerTotal = calculateHandTotal(gameState.dealerHand);

            if (playerTotal === 21 || dealerTotal === 21) {
                // æœ‰äººæ‹¿åˆ° Blackjackï¼Œç›´æ¥çµç®—
                gameState.phase = 'result';
                resolveResult();
            } else {
                setMessage('ç™¼ç‰Œå®Œæˆï¼Œè¼ªåˆ°ä½ äº†ã€‚');
            }

            render();
        }

        function hit() {
            if (gameState.phase !== 'player') return;

            const card = drawCard(gameState.deck);
            gameState.playerHand.push(card);

            setMessage(`ä½ æŠ½åˆ°äº† ${card.display}ã€‚`);

            const playerTotal = calculateHandTotal(gameState.playerHand);
            if (playerTotal > 21) {
                setMessage(`çˆ†ç‰Œäº†ï¼ï¼ˆ${playerTotal} é»ï¼‰ä½ è¼¸äº†ï¼`);
                gameState.phase = 'result';
                gameState.result = 'dealer_win';
            }

            render();
        }

        function stand() {
            if (gameState.phase !== 'player') return;

            setMessage('ä½ é¸æ“‡åœç‰Œï¼Œè¼ªåˆ°èŠå®¶ã€‚');
            gameState.phase = 'dealer';

            // å»¶é²åŸ·è¡ŒèŠå®¶å›åˆï¼Œè®“ç©å®¶çœ‹åˆ°è¨Šæ¯
            setTimeout(() => {
                dealerPlay();
            }, 800);
        }

        function dealerPlay() {
            render(); // å…ˆé¡¯ç¤ºèŠå®¶çš„å®Œæ•´æ‰‹ç‰Œ

            const dealerTotal = calculateHandTotal(gameState.dealerHand);
            
            if (dealerTotal < 17) {
                // èŠå®¶éœ€è¦æŠ½ç‰Œ
                setTimeout(() => {
                    const card = drawCard(gameState.deck);
                    gameState.dealerHand.push(card);
                    setMessage(`èŠå®¶æŠ½åˆ°äº† ${card.display}ã€‚`);
                    
                    const newTotal = calculateHandTotal(gameState.dealerHand);
                    if (newTotal > 21) {
                        setTimeout(() => {
                            setMessage(`èŠå®¶çˆ†ç‰Œäº†ï¼ï¼ˆ${newTotal} é»ï¼‰ä½ è´äº†ï¼`);
                            gameState.phase = 'result';
                            gameState.result = 'player_win';
                            render();
                        }, 800);
                    } else {
                        render();
                        dealerPlay(); // éè¿´ç¹¼çºŒæŠ½ç‰Œ
                    }
                }, 1000);
            } else {
                // èŠå®¶åœæ­¢æŠ½ç‰Œï¼Œé€²å…¥çµç®—
                setTimeout(() => {
                    resolveResult();
                }, 800);
            }
        }

        function resolveResult() {
            const playerTotal = calculateHandTotal(gameState.playerHand);
            const dealerTotal = calculateHandTotal(gameState.dealerHand);

            gameState.phase = 'result';

            // æª¢æŸ¥ Blackjackï¼ˆé¦–å…©å¼µ 21 é»ï¼‰
            const playerBlackjack = (gameState.playerHand.length === 2 && playerTotal === 21);
            const dealerBlackjack = (gameState.dealerHand.length === 2 && dealerTotal === 21);

            if (playerBlackjack && dealerBlackjack) {
                gameState.result = 'push';
                setMessage(`é›™æ–¹éƒ½æ˜¯ Blackjackï¼å¹³æ‰‹ï¼ˆPushï¼‰ã€‚`);
            } else if (playerBlackjack) {
                gameState.result = 'player_win';
                setMessage(`Blackjackï¼ä½ è´äº†ï¼ï¼ˆ${playerTotal} é» vs ${dealerTotal} é»ï¼‰`);
            } else if (dealerBlackjack) {
                gameState.result = 'dealer_win';
                setMessage(`èŠå®¶ Blackjackï¼ä½ è¼¸äº†ï¼ï¼ˆ${playerTotal} é» vs ${dealerTotal} é»ï¼‰`);
            } else if (playerTotal > 21) {
                gameState.result = 'dealer_win';
                setMessage(`ä½ çˆ†ç‰Œäº†ï¼ï¼ˆ${playerTotal} é»ï¼‰ä½ è¼¸äº†ï¼`);
            } else if (dealerTotal > 21) {
                gameState.result = 'player_win';
                setMessage(`èŠå®¶çˆ†ç‰Œäº†ï¼ï¼ˆ${dealerTotal} é»ï¼‰ä½ è´äº†ï¼`);
            } else if (playerTotal > dealerTotal) {
                gameState.result = 'player_win';
                setMessage(`ä½ è´äº†ï¼ï¼ˆ${playerTotal} é» vs ${dealerTotal} é»ï¼‰`);
            } else if (playerTotal < dealerTotal) {
                gameState.result = 'dealer_win';
                setMessage(`ä½ è¼¸äº†ï¼ï¼ˆ${playerTotal} é» vs ${dealerTotal} é»ï¼‰`);
            } else {
                gameState.result = 'push';
                setMessage(`å¹³æ‰‹ï¼ˆPushï¼‰ï¼ï¼ˆ${playerTotal} é» vs ${dealerTotal} é»ï¼‰`);
            }

            render();
        }

        function resetGame() {
            gameState.phase = 'idle';
            gameState.playerHand = [];
            gameState.dealerHand = [];
            gameState.result = null;
            setMessage('æ­¡è¿ä¾†åˆ° 21 é»éŠæˆ²ï¼æŒ‰ä¸‹ã€Œé–‹å§‹ç™¼ç‰Œã€é–‹å§‹éŠæˆ²ã€‚');
            render();
        }

        // ===== äº‹ä»¶ç¶å®š =====
        document.getElementById('start-btn').addEventListener('click', startRound);
        document.getElementById('hit-btn').addEventListener('click', hit);
        document.getElementById('stand-btn').addEventListener('click', stand);
        document.getElementById('reset-btn').addEventListener('click', resetGame);

        // åˆå§‹åŒ–
        render();
    </script>
</body>
</html>
